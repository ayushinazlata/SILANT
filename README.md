# Проект «СИЛАНТ»

Веб-приложение для ведения учёта техники, проведения технического обслуживания и регистрации рекламаций.  
Система разработана в рамках дипломного проекта и предназначена для трёх типов пользователей: **Клиент**, **Сервисная компания** и **Менеджер**.

---

## 1. Назначение системы

Система предоставляет следующие возможности:

- Просмотр технической информации о машинах предприятия.  
- Ведение записей о техническом обслуживании.  
- Регистрация и просмотр рекламаций.  
- Работа со справочниками, определяющими конфигурацию техники.  
- Поиск машины по заводскому номеру для неавторизованных пользователей.  
- Личный кабинет в виде вкладок (Машины, ТО, Рекламации).  
- Разграничение прав доступа между ролями.

---

## 2. Роли пользователей и права доступа

### **Гость**
- Может выполнять только поиск по заводскому номеру машины.
- Видит только ограниченный набор полей (1–10 по ТЗ).
- Не имеет доступа к ТО, рекламациям, справочникам.

### **Клиент**
- Видит только свои машины.
- Может добавлять записи о ТО.
- Может просматривать, но не добавлять рекламации.
- Не имеет доступа к справочникам.

### **Сервисная организация**
- Видит машины, закреплённые за своей сервисной компанией.
- Может добавлять ТО.
- Может добавлять рекламации по своим машинам.
- Не имеет доступа к списку справочников.

### **Менеджер**
- Полный доступ ко всем данным.
- Просмотр, создание, редактирование справочников.
- CRUD машин, ТО, рекламаций.
- Неограниченный доступ к API.

---

## 3. Основные сущности системы

### **Машина** (17 полей согласно ТЗ)
- Заводские номера узлов.  
- Модели (из справочников).  
- Дата отгрузки.  
- Клиент и сервисная организация.  
- Комплектация, договор поставки и др.

### **Техническое обслуживание**
- Вид ТО (справочник).  
- Дата проведения.  
- Наработка.  
- Номер и дата заказ-наряда.  
- Организация ТО.  
- Сервисная организация.

### **Рекламация**
- Дата отказа.  
- Описание отказа.  
- Наработка.  
- Узел отказа.  
- Способ восстановления.  
- Запасные части.  
- Дата восстановления.  
- **Время простоя** — вычисляемое поле.

### **Справочники**
- Модели техники.  
- Модели двигателя.  
- Модели трансмиссии.  
- Модели ведущего и управляемого моста.  
- Виды ТО.  
- Организации ТО.  
- Узлы отказа.  
- Способы восстановления.  

Менеджер имеет полный CRUD. Остальные роли — только просмотр карточки.

---

## 4. Главная страница

Для гостей доступен поиск по заводскому номеру.  
Для авторизованных пользователей доступны вкладки:

- **Общая информация**
- **ТО**
- **Рекламации**

Каждая таблица имеет фильтры, сортировки, пагинацию и кликабельность строк.

---

## 5. Кэширование справочников

В проекте используется кэширование списков и карточек справочников:

- уменьшает нагрузку на БД  
- ускоряет работу интерфейса  

---

## 6. API (REST)

API реализован с помощью Django REST Framework.  
Доступна документация:

- **Swagger**: `/swagger/`
- **ReDoc**: `/redoc/`

### Общие правила доступа

- Гость: доступ только к `/api/search/`
- Клиент: только данные по своим машинам и ТО
- Сервисная организация: данные своих машин, ТО и рекламаций
- Менеджер: полный доступ
- Удаление данных через API — **запрещено**

---

## 6.1. Эндпойнты API

### **Машины**
GET /api/machines/
POST /api/machines/ (только менеджер)
GET /api/machines/{id}/
PATCH /api/machines/{id}/ (только менеджер)
DELETE /api/machines/{id}/ (запрещено)

Фильтры:  
`machine_model`, `engine_model`, `transmission_model`, `factory_number`  
Сортировка: `?ordering=shipment_date`

---

### **Поиск машины**
GET /api/search/?factory_number=XXXX


- Гость получает ограниченные данные  
- Авторизованные — полные  
- Клиенты и сервисные компании видят только свои машины  

---

### **ТО**
GET /api/maintenance/
POST /api/maintenance/
PATCH /api/maintenance/{id}/ (только менеджер)
DELETE /api/maintenance/{id}/ (запрещено)


Фильтры:  
`maintenance_type`, `machine__factory_number`, `machine__service_company`

---

### **Рекламации**
GET /api/claims/
POST /api/claims/ (менеджер, сервисная компания)
PATCH /api/claims/{id}/ (только менеджер)
DELETE /api/claims/{id}/ (запрещено)


Фильтры:  
`failure_node`, `recovery_method`

---

## 7. Авторизация

Используется Django Allauth.

- Регистрация отключена (`is_open_for_signup = False`)
- Вход — по username
- Учетные записи создаёт администратор

---

## 8. База данных и миграции

Используется PostgreSQL.  
Все миграции актуальны и применяются автоматически.

---

## 9. Установка и запуск

Установка зависимостей:
pip install -r requirements.txt

Применение миграций:
python manage.py migrate

Создание администратора:
python manage.py createsuperuser

Запуск сервера:
python manage.py runserver


---

## 10. Используемые технологии

- Django 5
- Django REST Framework
- Django Allauth
- PostgreSQL
- DRF-YASG (Swagger / ReDoc)
- Django Filters
- Whitenoise
- Python-dotenv

---

## 11. Структура проекта

- `machines/` — машины и главная страница  
- `maintenance/` — техническое обслуживание  
- `claims/` — рекламации  
- `references/` — справочники  
- `users/` — кастомная модель пользователя  
- `templates/` — HTML-шаблоны  
- `static/` — CSS, JS, шрифты  
- `silant/` — настройки проекта  

---

## 12. Загрузка демонстрационных данных
Для удобства проверки проекта подготовлен набор тестовых данных:
пользователи, группы, справочники, машины, записи ТО и рекламации.
Чтобы загрузить их в базу, выполните:

`python manage.py loaddata fixtures/initial_data.json`

После загрузки будут доступны:
- **пользователи**:
`manager` — группа «Менеджер»
`client` — группа «Клиент»
`service` — группа «Сервисная организация»
- **справочники** — 18 записей
- **машины** — 4 шт.
- **ТО** — 8 записей
- **рекламации** — 8 записей

Этот набор данных позволяет полностью протестировать:
- права доступа;
- фильтрацию;
- отображение таблиц;
- логику работы менеджера, клиента и сервисной организации.

---