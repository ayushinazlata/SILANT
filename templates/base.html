<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Мой Силант{% endblock %}</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% load static %}

    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
</head>

<body>
    <header class="header">
        <div class="header__left">
            <img src="{% static 'images/logotype.svg' %}" alt="Силант" class="header__logo">
                <span class="header__name">Электронная сервисная книжка "Мой Силант"</span>
        </div>

        <nav class="header__right">
            <div class="header__row">

                {% if user.is_authenticated %}
                    <div class="header__contacts">
                        <div class="header__contact">
                            <img src="{% static 'icons/phone.svg' %}" alt="Телефон" class="header__icon">
                            <a href="tel:+7-8352-20-12-09" class="header__link">+7-8352-20-12-09</a>
                        </div>

                        <div class="header__contact">
                            <img src="{% static 'icons/telegram.svg' %}" alt="Telegram" class="header__icon">
                            <a href="silant" class="header__link">silant</a>
                        </div>
                    </div>

                    <form method="post" action="{% url 'account_logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="header__button">Выйти</button>
                    </form>

                {% else %}
                    <a href="?login=1" class="header__button">Авторизация</a>
                {% endif %}

            </div>
        </nav>

        <div class="header__mobile-right">

            {% if user.is_authenticated %}

                <!-- Бургер -->
                <button class="header__burger" id="burgerBtn">
                    <span></span><span></span><span></span>
                </button>

            {% else %}

                <a href="?login=1" class="header__login-icon">
                    <img src="{% static 'icons/login.svg' %}" alt="Войти">
                </a>

            {% endif %}
        </div>

        {% if user.is_authenticated %}
            <div class="header__mobile-menu" id="mobileMenu">

                <div class="header__mobile-item">
                    <img src="{% static 'icons/phone.svg' %}" class="header__icon">
                    <a href="tel:+7-8352-20-12-09" class="header__link">+7-8352-20-12-09</a>
                </div>

                <div class="header__mobile-item">
                    <img src="{% static 'icons/telegram.svg' %}" class="header__icon">
                    <a href="silant" class="header__link">silant</a>
                </div>

                <form method="post" action="{% url 'account_logout' %}">
                    {% csrf_token %}
                    <button type="submit" class="header__button header__button--mobile">Выйти</button>
                </form>

            </div>
        {% endif %}

    </header>

    <main>

        {% if messages %}
            <div class="alerts">
                {% for message in messages %}
                    <div class="alert alert--{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}

        {% block content %}
        {% endblock %}

    </main>

    <footer class="footer">
        <div class="footer__content">
            <div class="footer__contacts">
                <div class="footer__contact">
                    <img src="{% static 'icons/phone.svg' %}" alt="Телефон" class="footer__icon">
                    <a href="tel:+7-8352-20-12-09" class="footer__link">+7-8352-20-12-09</a>
                </div>

                <div class="footer__contact">
                    <img src="{% static 'icons/telegram.svg' %}" alt="Telegram" class="footer__icon">
                    <a href="silant" class="footer__link">silant</a>
                </div>
            </div>

            <div class="footer__right">
                <p>Мой Силант 2025</p>
            </div>
        </div>
    </footer>


    {% if show_login or request.GET.login == '1' %}
    <section id="loginModal" class="modal" aria-hidden="false">
        <div class="modal__dialog">

            <a href="/" class="modal__close" aria-label="Закрыть">×</a>

            <h2 class="modal__title">Вход в систему</h2>

            {% if form and form.errors %}
                <div class="modal__error">
                    {% if form.non_field_errors %}
                        {% for e in form.non_field_errors %}
                            <p>{{ e }}</p>
                        {% endfor %}
                    {% else %}
                        <p><strong>Ошибка:</strong> Проверьте логин и пароль.</p>
                    {% endif %}
                </div>
            {% endif %}

            <form method="post"
                action="/"
                class="modal__form"
                autocomplete="off">
                {% csrf_token %}

                <p>
                    <label>
                        Логин
                        <input type="text"
                            name="login"
                            value="{{ form.login.value|default_if_none:'' }}"
                            required
                            class="modal__input {% if form.login.errors %}modal__input-error{% endif %}">
                    </label>
                </p>

                <p>
                    <label>
                        Пароль
                        <input type="password"
                            name="password"
                            required
                            class="modal__input {% if form.password.errors %}modal__input-error{% endif %}">
                    </label>
                </p>

                <button type="submit" class="modal__submit">Войти</button>
            </form>
        </div>
    </section>

    <script>
        window.addEventListener("DOMContentLoaded", function () {
            const input = document.querySelector("#loginModal input[name='login']");
            if (input) input.focus();
        });
    </script>
    {% endif %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script src="{% static 'js/main.js' %}"></script>

</body>
</html>
